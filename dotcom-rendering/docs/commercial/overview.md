# Commercial overview

This document aims to describe the client-side commercial code in Dotcom Rendering.

Commercial code relates to:

-   Serving ads
-   Tracking related to ads

We load a single commercial script, `commercial.dcr.js`, as a high-priority item in the head (preload). The script is generated by frontend and performs the same loading of commercial modules as the classical `commercial.js` init script.

Among other tasks performed by the commercial modules we have

-   Consent management
-   Place dynamic ad slots
-   Populate ad slots (dynamic and static ones)
-   Load tracking scripts

## Working within Frontend, shared libraries

As a result of architectural decision, dotcom-rendering currently makes use of frontend existing commercial modules. This means that when modifying any of those libraries it is important to check that your changes have not broken anything in Dotcom Rendering (see section "Development change checklist" for some pointers).

That having been said, and when needed, once can make slight adjustement to an existing library to customise the code depending on whether it is working on Frontend or Dotcom Rendering by testing the value of `window.guardian.isDotcomRendering`. For this call

```
import config from 'lib/config';
config.get('isDotcomRendering', false)
```

## Working within DCR, Ad slots and components

Dotcom rendering has components for the following ad types

-   Static ads (top-above, nav, top-right, most-viewed, survey)
-   Dynamic ads (article in-body)
-   Mechandising slots (such as masterclass below-content onward component) [in progress...]

The components responsible for the rendering of the above are

-   `AdSlot.tsx`, for static and dynamic ads.

## The Guardian advertizing eco-system

To introduce some terms, we use:

-   [Prebid](https://prebid.org/overview/intro.html), for [header-bidding](https://digiday.com/media/wtf-header-bidding/)
-   [Google Ad Manager](https://en.wikipedia.org/wiki/Google_Ad_Manager)
-   [Ozone](https://www.ozoneproject.com/advertisers) an ad platform launched by a consortium of UK newspapers, including the Guardian

## Tracking

There are several more trackers on the site. A good way to visualise these is: [http://requestmap.webperf.tools/](http://requestmap.webperf.tools/).

## Development change checklist

Currently we do not have good automated tests covering the commercial stack in dotcom-rdnering. Once your change is ready, and depending on the nature of the change, here are the things you might want to have a look at.

-   Are the ad slots loading normaly when visually checking a page. Check the static slots as well as the inbody dynamic ones.
-   Are there any obvious console errors?
-   The Data & Insight team, can identify any widespread anomolies. Usually with a lag of a day or more.
